doctype html
html
  head
    title Device List
    meta(charset='UTF-8')
    meta(name='viewport', content='width=device-width, initial-scale=1.0')
    link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css')
  body
    .container.mt-5
      h1.text-center.mb-4 Danh sách thiết bị
      if devices && devices.length > 0
        // Bảng các thiết bị bình thường
        h2 Thiết bị hiện tại
        table.table.table-bordered
          thead
            tr
              th Tên thiết bị
              th Số lượng
              th Thời gian
          tbody#device-list
            each device in devices
              if !device.missing
                tr
                  td= device.name
                  td= device.quantity
                  td= new Date(device.checkedAt).toLocaleString()

        // Bảng các vật phẩm bị mất
        h2 Vật phẩm bị mất
        table.table.table-bordered
          thead
            tr
              th Tên thiết bị
              th Số lượng
              th Thời gian
          tbody#missing-list
            each device in devices
              if device.missing
                tr
                  td= device.name
                  td= device.quantity
                  td= new Date(device.checkedAt).toLocaleString()
      else
        p.text-center.text-muted Chưa có lịch sử tìm kiếm.

      .text-center.mt-4
        button#checking.btn.btn-primary Checking

      script(src="/socket.io/socket.io.js")
      script.
        const socket = io();
        document.getElementById('checking').addEventListener('click', () => {
          socket.emit('checking');
        });

        socket.on('ml_response', (data) => {
          const deviceList = document.getElementById('device-list');
          const missingList = document.getElementById('missing-list');
          deviceList.innerHTML = ''; 
          missingList.innerHTML = '';
          if (data.devices && data.devices.length > 0) {
            data.devices.forEach(device => {
              const rowHtml = `
                <td>${device.name}</td>
                <td>${device.quantity}</td>
                <td>${new Date(device.checkedAt).toLocaleString()}</td>
              `;
              if (device.missing) {
                missingList.innerHTML += `<tr>${rowHtml}</tr>`;
              } else {
                deviceList.innerHTML += `<tr>${rowHtml}</tr>`;
              }
            });
          }
        });
